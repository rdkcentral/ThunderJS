/**
 * If not stated otherwise in this file or this component's LICENSE file the
 * following copyright and licenses apply:
 *
 * Copyright 2025 Metrological
 *
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

var ThunderJS=function(){"use strict";function c(n){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}function e(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function t(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach(function(n){var e,t,r;e=o,r=i[t=n],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(n){Object.defineProperty(o,n,Object.getOwnPropertyDescriptor(i,n))})}return o}function r(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(n)))return;var t=[],r=!0,o=!1,i=void 0;try{for(var c,u=n[Symbol.iterator]();!(r=(c=u.next()).done)&&(t.push(c.value),!e||t.length!==e);r=!0);}catch(n){o=!0,i=n}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return t}(n,e)||function(n,e){if(!n)return;if("string"==typeof n)return o(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);"Object"===t&&n.constructor&&(t=n.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return o(n,e)}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}var n=null;"undefined"!=typeof WebSocket&&(n=WebSocket);function u(e){if("string"==typeof e){e=(e=e.normalize().replace(/\\\\x([0-9A-Fa-f]{2})/g,"")).normalize().replace(/\\x([0-9A-Fa-f]{2})/g,""),e=JSON.parse(e)}if(!e.id&&e.method){var n=a[e.method];n&&Array.isArray(n)&&n.length&&n.forEach(function(n){n(e.params)})}}function v(c){return new Promise(function(e,t){var n,r=[(n=c)&&n.protocol||"ws://",n&&n.host||"localhost",":"+(n&&n.port||80),n&&n.endpoint||"/jsonrpc",n&&n.token?"?token="+n.token:null].join(""),o=l[r];if(o&&1===o.readyState)return e(o);if(o&&0===o.readyState){return o.addEventListener("open",function n(){o.removeEventListener("open",n),e(o)})}if(null==o){c.debug&&console.log("Opening socket to "+r),o=new s(r,c&&c.subprotocols||"notification"),(l[r]=o).addEventListener("message",function(n){c.debug&&(console.log(" "),console.log("API REPONSE:"),console.log(JSON.stringify(n.data,null,2)),console.log(" ")),function(n){if("string"==typeof n){n=(n=n.normalize().replace(/\\\\x([0-9A-Fa-f]{2})/g,"")).normalize().replace(/\\x([0-9A-Fa-f]{2})/g,""),n=JSON.parse(n)}if(n.id){var e=y[n.id];e?("result"in n?e.resolve(n.result):e.reject(n.error),delete y[n.id]):console.log("no pending request found with id "+n.id)}}(n.data)}),o.addEventListener("message",function(n){u(n.data)}),o.addEventListener("error",function(){u({method:"client.ThunderJS.events.error"}),l[r]=null});var i=function(n){l[r]=null,t(n)};o.addEventListener("close",i),o.addEventListener("open",function(){u({method:"client.ThunderJS.events.connect"}),o.removeEventListener("close",i),o.addEventListener("close",function(){u({method:"client.ThunderJS.events.disconnect"}),l[r]=null}),e(o)})}else l[r]=null,t("Socket error")})}function i(d){return{request:function(l,f,p){return new Promise(function(n,e){var t,r,o,i,c,u=h+=1,s=(t=d.versions,r=l,(i=(o=p)&&o.version)?i:t&&(t[r]||t.default)||1),a=function(n,e,t,r,o){r&&(delete r.version,r.versionAsParameter&&(r.version=r.versionAsParameter,delete r.versionAsParameter));var i={jsonrpc:"2.0",id:n,method:[e,o,t].join(".")};return void 0!==r&&(i.params=r),i}(u,l,f,p,s);d.debug&&(console.log(" "),console.log("API REQUEST:"),console.log(JSON.stringify(a,null,2)),console.log(" ")),y[u]={body:a,resolve:n,reject:e},c=a,v(d).then(function(n){n.send(JSON.stringify(c))}).catch(function(n){e(n)})})}}}var s=n,y={},a={},l={},h=0,f={DeviceInfo:{freeRam:function(n){return this.call("systeminfo",n).then(function(n){return n.freeram})},version:function(n){return this.call("systeminfo",n).then(function(n){return n.version})}}};function p(e,t,n,r){var o=this,i=function(n,e,t,r){var o=d(n,e);if(!a[o]){a[o]=[];if(n!=="ThunderJS"){var i="register";var c=o.split(".").slice(0,-1).join(".");var u={event:e,id:c};this.api.request(n,i,u).catch(function(n){if(typeof r==="function")r(n.message)})}}return a[o].push(t),a[o].length-1}.call(this,e,t,n,r);return{dispose:function(){var n=d(e,t);void 0!==a[n]&&(a[n][i]=void 0,a[n].every(function(n){return void 0===n})&&function(n,e,t){var r=d(n,e);if(delete a[r],n!=="ThunderJS"){var o="unregister";var i=r.split(".").slice(0,-1).join(".");var c={event:e,id:i};this.api.request(n,o,c).catch(function(n){if(typeof t==="function")t(n.message)})}}.call(o,e,t,r))}}}function d(n,e){return["client",n,"events",e].join(".")}var g,b=[];g=function(){for(var n=b.length,e=0;e<n;e++)"function"==typeof b[e]&&b[e]()},"undefined"!=typeof window&&window.addEventListener?window.addEventListener("unload",function(){g()}):"undefined"!=typeof process&&process.on&&(process.on("exit",function(){g()}),process.on("SIGINT",function(){g()}));var m=function t(n){return{options:n,api:i(n),plugin:!1,call:function(){var n=Array.prototype.slice.call(arguments);this.plugin&&n[0]!==this.plugin&&n.unshift(this.plugin);var e=n[0],t=n[1];return"function"==typeof this[e][t]?this[e][t](n[2]):this.api.request.apply(this,n)},registerPlugin:function(n,e){this[n]=w(Object.assign(Object.create(t),e,{plugin:n}))},subscribe:function(){},on:function(){var n=O.apply(void 0,[this.plugin].concat(Array.prototype.slice.call(arguments))),e=p.apply(this,n);return b.push(e.dispose),e},once:function(){var n=O.apply(void 0,[this.plugin].concat(Array.prototype.slice.call(arguments))),e=r(n,3)[2];n[2]=function(){e.apply(void 0,arguments),t.dispose()};var t=p.apply(this,n);return b.push(t.dispose),t}}},w=function n(e){return new Proxy(e,{get:function(r,o){var i=r[o];return"api"===o?r.api:void 0!==i?"function"==typeof i?-1<["on","once","subscribe"].indexOf(o)?function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return i.apply(this,e)}:function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(t,n){"object"===c(t)&&("object"!==c(t)||t.then&&"function"==typeof t.then)||(t=new Promise(function(n,e){(t instanceof Error==!1?n:e)(t)}));var e="function"==typeof n[n.length-1]?n[n.length-1]:null;if(!e)return t;t.then(function(n){return e(null,n)}).catch(function(n){return e(n)})}(i.apply(this,e),e)}:"object"===c(i)?n(Object.assign(Object.create(m(r.options)),i,{plugin:o})):i:!1===r.plugin?n(Object.assign(Object.create(m(r.options)),{},{plugin:o})):function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return e.unshift(o),r.call.apply(this,e)}}})};function O(n){for(var e=arguments.length,t=new Array(1<e?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return-1!==["connect","disconnect","error"].indexOf(t[0])?t.unshift("ThunderJS"):n&&t[0]!==n&&t.unshift(n),t}return function(n){return void 0===n.token&&"undefined"!=typeof window&&window.thunder&&"function"==typeof window.thunder.token&&(n.token=window.thunder.token()),w(t({},m(n),{},f))}}();
